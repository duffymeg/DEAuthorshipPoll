---
title: "Authorship Poll Analysis"
author: "Meghan Duffy"
date: "June 15, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

#What are the current views on last and corresponding authorship in ecology?

###Analysis of data from Dynamic Ecology poll regarding authorship practices in ecology

## Introduction

Who is the last author on a paper? Is it the person who did the least work? Or is it the PI of the lab where the work was done? When I started grad school (in 2000), the norm in ecology was still that the last author on a paper is the person who did the least work. But, more recently, it has seemed to me that the norm is that the last author on a paper is the "senior" author (usually the PI). However, if you talk with other ecologists about the topic, it's clear that there's variation in views, and that not everyone is on the same page.

{add more here on literature and what others have done on similar topics -- see Evernote file for more on that}

Thinking about this topic as we were settling on authorship order for a manuscript recently led me to post [a series of tweets where I mused about authorship practices in ecology](https://twitter.com/duffy_ma/status/710917668446928896 )
which then led me to do [a poll on Dynamic Ecology related to the topic](https://dynamicecology.wordpress.com/2016/04/06/poll-what-are-your-views-on-last-and-corresponding-authorship-in-ecology/).
The poll was developed with input from Alex Bond, Linda Campbell, Kathy Cottingham, and Andrea Kirkwood, who all helped me think through what to ask about and how to phrase the questions and answer options. Many thanks to them for their help! And, while I'm doing acknowledgments, Auriel Fournier, Jaime Ashander, and Rayna Harris provided R help that got me over some key hurdles. Finally, this poll was confirmed as exempt from ongoing IRB review (UMich IRB #: HUM00114140). 

## The poll
The poll had four main questions:  

1. For ecology papers, do you consider the last author to be the senior author?  
2. Which of the following statements most closely matches the current norms in ecology in terms of who is corresponding author?  
3. Which of the following statements would be best practice in terms of who is corresponding author?  
4. If someone includes a statement on his/her CV indicating they have used a first/last author emphasis, do you pay attention to that?  

It also asked about the respondent's primary research area, whether their research is primarily basic or applied, how frequently they conduct interdisciplinary research, how many years post-PhD they are, where they live, and what their current department is.  

The poll first appeared on 6 April 2016 and ran for two weeks. 

## Data manipulation
Four blank entries were deleted. I am a bad person and used excel to add in numeric codes for the different answers. The key is:  

For the question about whether last author is the senior author:  
```
1 = No  
2 = It depends, but probably no  
3 = Not sure, but probably no  
4 = Not sure, but probably yes  
5 = It depends, but probably yes  
6 = Yes  
```

For the question about current corresponding author practices:  
```
1 = The corresponding author is the person that has taken responsibility for fielding questions about the paper post-publication  
2 = The corresponding author is the person with the most stable contact info and/or internet access  
3 = The corresponding author is usually the person who uploaded the files (usually the first author)  
4 = The corresponding author is usually the senior author  
5 = The corresponding author uploaded the files, managed the revisions and wrote the response to reviewers, and took responsibility for the paper after publication  
```
 
For the question about best corresponding author practices:  
```
1 = The corresponding author should be the person that has taken responsibility for fielding questions about the paper post-publication  
2 = The corresponding author should be the person with the most stable contact info and/or internet access  
3 = The corresponding author should be whichever person uploaded the files (usually the first author)
4 = The corresponding author should be the senior author  
5 = The corresponding author should be the person who uploaded the files, managed the revisions and wrote the response to reviewers, and took responsibility for the paper after publication  
```

For the question about the CV statement:  
```
1 = No  
2 = I have never seen this, but would probably not pay attention to it  
3 = I have never seen this, but would probably pay attention to it  
4 = Yes  
```

For the question about research area:  
```
1 = Ecology (primarily field-based)  
2 = Ecology (primarily wet-lab based, including molecular ecology)  
3 = Ecology (primarily computational-based)  
4 = Evolutionary biology (primarily molecular)  
5 = Evolutionary biology (primarily organismal)  
6 = Biology other than EEB  
7 = Outside biology  
```

For the basic vs. applied question:  
```
1 = basic  
2 = applied  
```

For the interdisciplinarity question:  
```
1 = Never  
2 = Rarely  
3 = Sometimes  
4 = Often  
5 = Always  
```

Years since PhD  
```
1 = 0 (current students and people without a PhD should choose this)  
2 = 1-5  
3 = 6-10  
4 = 11-15  
5 = 16-20  
6 = >20  
7 = I do not have a PhD and am not a current student  
```

Where live?  
```
1 = Africa  
2 = Asia  
3 = Australia  
4 = Europe  
5 = North America  
6 = South America  
```

Department:  
```
1 = An EEB department (or similar)  
2 = A biology department  
3 = A natural resources department (or similar)  
4 = other  
```

## Basic overview of responses
After removing the four blank responses, there were 1122 responses to the poll. What did the respondents look like?  

```{r, make sure have github version of ggplot2}
#install.packages("devtools")
#devtools::install_github("tidyverse/ggplot2")

#uncomment one or both of the above lines if needed; tried out the github version of ggplot to work on the bar width issue, but decided to go back to CRAN version
```

```{r, import, message=FALSE, warning=FALSE}
# Import data
polldata <- read.csv("AuthorshipPollResults.csv", na.strings=".")
# load libraries needed to run code
library(ggplot2)
library(dplyr)
library(cowplot)
library(knitr)
require(likert)
library(reshape2)
library(magrittr)
library(forcats)
library(lubridate)
library(gridExtra)
```

```{r}
PrimaryResearchArea <-
  polldata %>%
  filter(!is.na(PrimaryResearch)) %>%
  group_by(PrimaryResearch) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

kable(PrimaryResearchArea, caption = "Primary Research Area of Respondents")

BasicAppliedSplit <-
  polldata %>%
  filter(!is.na(BasicApplied)) %>%
  group_by(BasicApplied) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

kable(BasicAppliedSplit)

Interdisciplinarity <-
  polldata %>%
  filter(!is.na(Interdisciplinary)) %>%
  group_by(Interdisciplinary) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

Reorder <- function(x, ordering=c(1,3,5,4,2))
    factor(x, levels(x)[ordering])

Interdisciplinarity$Interdisciplinary <- Reorder(Interdisciplinarity$Interdisciplinary)
kable(Interdisciplinarity[order(Interdisciplinarity$Interdisciplinary), ])

YearsPostPhD <-
  polldata %>%
  filter(!is.na(YearssincePhD)) %>%
  group_by(YearssincePhD) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

Reorder <- function(x, ordering=c(2,6,3,4,5,1,7))
  factor(x, levels(x)[ordering])

YearsPostPhD$YearssincePhD <- Reorder(YearsPostPhD$YearssincePhD)
kable(YearsPostPhD[order(YearsPostPhD$YearssincePhD), ])
#This one has problem of rendering as dates instead of year ranges. Need to fix that.

Continent <-
  polldata %>%
  filter(!is.na(WhereLive)) %>%
  group_by(WhereLive) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

kable(Continent)

Department <-
  polldata %>%
  filter(!is.na(Dept01)) %>%
  group_by(Dept01) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

kable(Department)
```

## Results for the four main questions

### Q1: "For ecology papers, do you consider the last author to be the senior author?"
```{r, q1-fig}
LastSeniorSum <- 
  polldata %>%
  filter(!is.na(LastSenior01)) %>%
  group_by(LastSenior01) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

LastSeniorSum
#Note: most frequent response (option 6) is 43%
#Sum of all the "yes" options = 86%

as.factor(LastSeniorSum$LastSenior01)

require(cowplot)
lastseniorplot <- ggplot(LastSeniorSum,aes(x=LastSenior01,y=rel.freq,fill=LastSenior01)) +
  geom_bar(stat="identity") +
  ylab("Percent of responses") +
  theme(legend.position="none") +
  coord_flip() +
  theme(axis.text.y = element_blank()) +
  annotate("text", x = 1, y = 9, label = "No", hjust=0, size=3) +
  annotate("text", x = 2, y = 9, label = "It depends, but probably no", hjust=0, size=3) +
  annotate("text", x = 3, y = 9, label = "Not sure, but probably no", hjust=0, size=3) +
  annotate("text", x = 4, y = 9, label = "Not sure, but probably yes", hjust=0, size=3) +
  annotate("text", x = 5, y = 01, label = "It depends, but probably yes", hjust=0, size=3) +
  annotate("text", x = 6, y = 01, label = "Yes", hjust=0, size=3) +
  ggtitle("For ecology papers, \ndo you consider the last author \nto be the senior author?") +
  theme(plot.title=element_text(size=12)) +
  theme(axis.title.y=element_blank()) +
  theme(axis.title.x=element_text(size=12)) +
  theme(axis.ticks.y = element_blank())

save_plot("lastseniorplot.jpg", lastseniorplot)

lastseniorplot

#grayscaleversion:
LastSeniorSum$LastSenior01c <- as.factor(LastSeniorSum$LastSenior01)
lastseniorplotgray <- ggplot(LastSeniorSum,aes(x=LastSenior01c,y=rel.freq,fill=LastSenior01c)) +
  geom_bar(stat="identity") +
  scale_fill_manual(values=c("#000000","#000000","#000000","#CCCCCC","#CCCCCC","#CCCCCC")) +
  ylab("Percent of responses") +
  theme(legend.position="none") +
  coord_flip() +
  theme(axis.text.y = element_blank()) +
  annotate("text", x = 1, y = 9, label = "No", hjust=0, size=3.5) +
  annotate("text", x = 2, y = 9, label = "It depends, but probably no", hjust=0, size=3.5) +
  annotate("text", x = 3, y = 9, label = "Not sure, but probably no", hjust=0, size=3.5) +
  annotate("text", x = 4, y = 9, label = "Not sure, but probably yes", hjust=0, size=3.5) +
  annotate("text", x = 5, y = 01, label = "It depends, but probably yes", hjust=0, size=3.5) +
  annotate("text", x = 6, y = 01, label = "Yes", hjust=0, size=3.5) +
  ggtitle("For ecology papers, \ndo you consider the last author \nto be the senior author?") +
  theme(plot.title=element_text(size=12)) +
  theme(axis.title.y=element_blank()) +
  theme(axis.title.x=element_text(size=12)) +
  theme(axis.ticks.y = element_blank()) 

lastseniorplotgray

save_plot("lastseniorplotgray.jpg", lastseniorplotgray)
```

### Q2: "Which of the following statements most closely matches the current norms in ecology in terms of who is corresponding author?"
```{r, q2-fig}
CurrentCorrespondingSum <- 
  polldata %>%
  filter(!is.na(CorrespondingCurrent01)) %>%
  group_by(CorrespondingCurrent01) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CurrentCorrespondingSum
#most frequent answer (option 5) = 54%
#option 3 = 19%, option 1 = 16%

currentcorrespondingplot <- ggplot(CurrentCorrespondingSum,aes(x=CorrespondingCurrent01,y=rel.freq)) +
  geom_bar(stat="identity") +
  ylab("Percent of responses") +
  theme(legend.position="none") +
  coord_flip() +
  theme(axis.text.y = element_blank()) +
  annotate("text", x = 1, y = 16.7, label = "The corresponding author is the person that has taken \nresponsibility for fielding questions about the paper \npost-publication",hjust=0,size=2.5) +
  annotate("text", x = 2, y = 3.5, label = "The corresponding author is the person with the most stable contact info \nand/or internet access",hjust=0,size=2.5) +
  annotate("text", x = 3, y = 19.5, label = "The corresponding author is usually the person who \nuploaded the files (usually the first author)",hjust=0,size=2.5) +
  annotate("text", x = 4, y = 7.6, label = "The corresponding author is usually the senior author",hjust=0,size=2.5) +
  annotate("text", x = 5, y = 1, color="white", label = "The corresponding author uploaded the files, managed the revisions and \nwrote the response to reviewers, and took responsibility for the paper after \npublication",hjust=0,size=2.5) +
  ggtitle("Which of the following statements most \nclosely matches the current norms in \necology in terms of who is corresponding author?") +
  theme(plot.title=element_text(size=12)) +
  theme(axis.title.y=element_blank()) +
  theme(axis.title.x=element_text(size=12)) +
  theme(axis.ticks.y = element_blank())

save_plot("currentcorrespondingplot.jpg", currentcorrespondingplot)
currentcorrespondingplot
```

### Q3: "Which of the following statements would be best practice in terms of who is corresponding author?"
```{r, q3-fig}
BestCorrespondingSum <- 
  polldata %>%
  filter(!is.na(CorrespondingBest01)) %>%
  group_by(CorrespondingBest01) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

BestCorrespondingSum
#most frequent answer (option 5) = 61%
#option 1 = 24%

bestcorrespondingplot <- ggplot(BestCorrespondingSum,aes(x=CorrespondingBest01,y=rel.freq)) +
  geom_bar(stat="identity") +
  ylab("Percent of responses") +
  theme(legend.position="none") +
  coord_flip() +
  theme(axis.text.y = element_blank()) +
  annotate("text", x = 1, y = 24.5, label = "The corresponding author should be the person \nthat has taken responsibility for fielding questions \nabout the paper post-publication",hjust=0,size=2.5) +
  annotate("text", x = 2, y = 5, label = "The corresponding author should be the person with the most stable \ncontact info and/or internet access",hjust=0,size=2.5) +
  annotate("text", x = 3, y = 9, label = "The corresponding author should be whichever person uploaded \nthe files (usually the first author)",hjust=0,size=2.5) +
  annotate("text", x = 4, y = 5, label = "The corresponding author should be the senior author",hjust=0,size=2.5) +
  annotate("text", x = 5, y = 1, color="white", label = "The corresponding author should be the person who uploaded the files, \nmanaged the revisions and wrote the response to reviewers, \nand took responsibility for the paper after publication",hjust=0,size=2.5) +
  ggtitle("Which of the following statements would be the \nbest practice in terms of who is \ncorresponding author?") +
  theme(plot.title=element_text(size=12)) +
  theme(axis.title.y=element_blank()) +
  theme(axis.title.x=element_text(size=12)) +
  theme(axis.ticks.y = element_blank()) +
  ylim(0,65)

save_plot("bestcorrespondingplot.jpg", bestcorrespondingplot, base_width = 6, base_height = 4)
bestcorrespondingplot
```

```{r, plot comparing current and best practices}
BestCorrespondingSum$Corresponding01 <- BestCorrespondingSum$CorrespondingBest01
BestCorrespondingSum$bestcurrent <- c("best","best","best","best","best")
CurrentCorrespondingSum$Corresponding01 <- CurrentCorrespondingSum$CorrespondingCurrent01
CurrentCorrespondingSum$bestcurrent <- c("current","current","current","current","current")

CombinedCorrespondingSum <- bind_rows(BestCorrespondingSum,CurrentCorrespondingSum)

combinedcorrespondingplot <- ggplot(CombinedCorrespondingSum,aes(x=Corresponding01,y=rel.freq,fill= bestcurrent)) +
  geom_bar(stat="identity",position=position_dodge()) +
  ylab("Percent of responses") +
  coord_flip() +
  theme(axis.text.y = element_blank()) +
  annotate("text", x = 1, y = 24.5, label = "The corresponding author should be the person \nthat has taken responsibility for fielding questions \nabout the paper post-publication",hjust=0,size=4) +
  annotate("text", x = 2, y = 5, label = "The corresponding author should be the person with the most stable \ncontact info and/or internet access",hjust=0,size=4) +
  annotate("text", x = 3, y = 20, label = "The corresponding author should be whichever person \nuploaded the files (usually the first author)",hjust=0,size=4) +
  annotate("text", x = 4, y = 8, label = "The corresponding author should be the senior author",hjust=0,size=4) +
  annotate("text", x = 5, y = 1, color="black", label = "The corresponding author should be the person who uploaded the files, \nmanaged the revisions and wrote the response to reviewers, \nand took responsibility for the paper after publication",hjust=0,size=4) +
  theme(plot.title=element_text(size=12)) +
  theme(axis.title.y=element_blank()) +
  theme(axis.title.x=element_text(size=12)) +
  theme(axis.ticks.y = element_blank()) +
  scale_fill_manual(values=c("#999999", "#99CCFF"))

combinedcorrespondingplot

save_plot("combinedcorrespondingplot.jpg", combinedcorrespondingplot, base_width = 8, base_height = 6)

## NOTE: The above figure is Figure 3 for the manuscript.
```

### Q4: "If someone includes a statement on his/her CV indicating they have used a first/last author emphasis, do you pay attention to that?"

```{r, q4-fig}
CVStatementSum <- 
  polldata %>%
  filter(!is.na(CVStatement01)) %>%
  group_by(CVStatement01) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CVStatementSum
#most people haven't seen such a statement (options 2+3 = 70%)
#most people either pay attention to such a statement or think they would: (options 3+4 = 71%)
#but the proportion of people who would ignore such a statement isn't exactly trivial!

CVstatementplot <- ggplot(CVStatementSum,aes(x=CVStatement01,y=rel.freq,fill=CVStatement01)) +
  geom_bar(stat="identity") +
  ylab("Percent of responses") +
  theme(legend.position="none") +
  coord_flip() +
  theme(axis.text.y = element_blank()) +
  annotate("text", x = 1, y = 1, color="white", label = "No",hjust=0,size=2.5) +
  annotate("text", x = 2, y = 1, color="white", label = "I have never seen this, but \nwould probably not pay \nattention to it",hjust=0,size=2.5) +
  annotate("text", x = 3, y = 1, color="black", label = "I have never seen this, but would probably pay attention to it",hjust=0,size=2.5) +
  annotate("text", x = 4, y = 1, color="black", label = "Yes",hjust=0,size=2.5) +
  ggtitle("If someone includes a statement on his/her \nCV indicating they have used a first/last \nauthor emphasis, do you pay attention to that?") +
  theme(plot.title=element_text(size=12)) +
  theme(axis.title.y=element_blank()) +
  theme(axis.title.x=element_text(size=12)) +
  theme(axis.ticks.y = element_blank())

save_plot("CVstatementplot.jpg", CVstatementplot)
CVstatementplot

#grayscale version:
CVStatementSum$CVStatement01c <- as.factor(CVStatementSum$CVStatement01)
CVstatementplotgray <- ggplot(CVStatementSum,aes(x=CVStatement01c,y=rel.freq,fill=CVStatement01c)) +
  geom_bar(stat="identity") +
  scale_fill_manual(values=c("#000000","#000000","#CCCCCC","#CCCCCC")) +
  ylab("Percent of responses") +
  theme(legend.position="none") +
  coord_flip() +
  theme(axis.text.y = element_blank()) +
  annotate("text", x = 1, y = 1, color="white", label = "No",hjust=0,size=3.5) +
  annotate("text", x = 2, y = 1, color="white", label = "I have never seen this, \nbut would probably not \npay attention to it",hjust=0,size=3.5) +
  annotate("text", x = 3, y = 1, color="black", label = "I have never seen this, but would probably \npay attention to it",hjust=0,size=3.5) +
  annotate("text", x = 4, y = 1, color="black", label = "Yes",hjust=0,size=3.5) +
  ggtitle("If someone includes a statement on his/her \nCV indicating they have used a first/last \nauthor emphasis, do you pay attention to that?") +
  theme(plot.title=element_text(size=12)) +
  theme(axis.title.y=element_blank()) +
  theme(axis.title.x=element_text(size=12)) +
  theme(axis.ticks.y = element_blank())

save_plot("CVstatementplotgray.jpg", CVstatementplotgray)
CVstatementplotgray
```

```{r, combined Figure 1 for paper}
figure1 <- plot_grid(lastseniorplotgray, CVstatementplotgray, labels = c("A", "B"), nrow = 2, align = "v")

figure1

save_plot("figure1.jpg", figure1, base_width = 4, base_height = 8)



```

## Looking at cross-tabs

### Does whether people view the last author as the senior author vary based on age, country, research area, and/or department?

```{r, cross tabs related to last authorship}
## first, making a "molecular" variable
polldata$molecular <- ifelse(polldata$PrimaryResearch01 == 2 | polldata$PrimaryResearch == 4, "molecular",
                             ifelse(polldata$PrimaryResearch01 == 1 | polldata$PrimaryResearch == 5,"organismal","other"
                             ))

## make an ecology vs. evolution variable:
polldata$ecoevo <- ifelse(polldata$PrimaryResearch01 < 4, "ecology",
                             ifelse(polldata$PrimaryResearch01 == 4 | polldata$PrimaryResearch == 5,"evolution","other"
                             ))

# next, make a variable for department type
polldata$depttype <- ifelse(polldata$Dept01 == 1, "eeb",
                            ifelse(polldata$Dept01 == 2, "bio",
                            ifelse(polldata$Dept01 == 3, "natres","other"
                            )))

## subsetting only the last author data, but first filter by the grouping variables of interest
## then renaming factors, renaming question
lastdata <-
  polldata %>%
  filter(CorrespondingBest01 != "NA", LastSenior != "NA", 
         WhereLive != "NA", BasicApplied != "NA", 
         depttype != "NA", PrimaryResearch != "NA", Inter01 != "NA") %>% 
  select(LastSenior) 

# order the data
lastdata$LastSenior <- factor(lastdata$LastSenior, 
                                      c("No",
                                        "Not sure, but probably no",
                                        "It depends, but probably no",
                                        "It depends, but probably yes",
                                        "Not sure, but probably yes",
                                        "Yes"))

# changing the column name to the question
colnames(lastdata)[1] <- "Is the last author the senior author?"

## subsetting the likert data AND the grouping variables
lastdata_grouping <-
  polldata %>%
  filter(CorrespondingBest01 != "NA", LastSenior != "NA", 
         WhereLive != "NA", BasicApplied != "NA", 
         depttype != "NA", PrimaryResearch != "NA", Inter01 != "NA") %>%
  select(molecular, 
         WhereLive, BasicApplied, 
         depttype, PrimaryResearch,
         ecoevo, Interdisciplinary, YearssincePhD) 

## ordering the grouping factors
## then renaming the primary research responses
lastdata_grouping$molecular <- factor(lastdata_grouping$molecular, 
                                            c("molecular",
                                              "organismal", 
                                              "other"))

lastdata_grouping$Interdisciplinary <- factor(lastdata_grouping$Interdisciplinary, 
                                     c("Always",
                                       "Often",
                                       "Sometimes",
                                       "Rarely",
                                       "Never"))

levels(lastdata_grouping$PrimaryResearch) <- c("Biology Other", "Comp Ecol", "Field Ecol", "Lab Mol Ecol", "Mol Evol", "Organismal Evol", "Other")

lastdata_grouping$YearssincePhD <- lastdata_grouping %>%
  use_series(YearssincePhD) %>%
  plyr::mapvalues(., c(">20","0 (current students should choose this)","10-Jun","15-Nov", "16-20", "5-Jan", "I do not have a PhD and am not a current student"), c(">20", "0","6-10","11-15", "16-20", "1-5", "no PhD, not student"))

lastdata_grouping$PrimaryResearch <- lastdata_grouping %>%
  use_series(PrimaryResearch) %>%
  plyr::mapvalues(., c("Biology other than EEB","Ecology (primarily computational-based)",
                       "Ecology (primarily field-based)","Ecology (primarily wet-lab based, including molecular ecology)", 
                       "Evolutionary biology (primarily molecular)", "Evolutionary biology (primarily organismal)", "Outside biology"), 
                  c("Biology Other", "Comp Ecol","Field Ecol","Lab Mol Ecol", "Mol Evol", "Organismal Evol", "Other"))


lastdata_grouping$YearssincePhD <- factor(lastdata_grouping$YearssincePhD, 
                                     c("0",
                                       "1-5",
                                       "6-10",
                                       "11-15",
                                       "16-20",
                                       ">20", 
                                       "no PhD, not student"))
```

```{r, q1-4panelcrosstabfig, warning=FALSE}
counts = lastdata_grouping %>%
  count(depttype) %>%
  mutate(variable=NA)

colnames(lastdata)[1] <- "Department type"
likert_32 <- likert(lastdata, grouping = lastdata_grouping$depttype)
depttypelikertplot = plot(likert_32) + 
  geom_text(data=counts,
            aes(label=format(n,big.mark=","), x=depttype, y=145), 
            size=3, colour="black", hjust=1) +
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(plot.margin=unit(c(0.2,2,0.2,0.2),"cm")) + theme(legend.position = "none")

depttypelikertplot <- ggplot_gtable(ggplot_build(depttypelikertplot))
depttypelikertplot$layout$clip <- "off"
depttypelikertplot.mpg <- plot(depttypelikertplot)

plot(depttypelikertplot)

counts = lastdata_grouping %>%
  count(BasicApplied) %>%
  mutate(variable=NA)

colnames(lastdata)[1] <- "Basic v. Applied"
likert_42 <- likert(lastdata, grouping = lastdata_grouping$BasicApplied)
basicappliedlikertplot = plot(likert_42) + 
  geom_text(data=counts,
            aes(label=format(n,big.mark=","), x=BasicApplied, y=145), 
            size=3, colour="black", hjust=1) +
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(plot.margin=unit(c(0.2,2,0.2,0.2),"cm")) + theme(legend.position = "none")

basicappliedlikertplot <- ggplot_gtable(ggplot_build(basicappliedlikertplot))
basicappliedlikertplot$layout$clip <- "off"

counts = lastdata_grouping %>%
  count(PrimaryResearch) %>%
  mutate(variable=NA)

colnames(lastdata)[1] <- "Primary Research Area"
likert_52 <- likert(lastdata, grouping = lastdata_grouping$PrimaryResearch)
primaryresearchlikertplot = plot(likert_52) + 
  geom_text(data=counts,
            aes(label=format(n,big.mark=","), x=PrimaryResearch, y=145), 
            size=3, colour="black", hjust=1) +
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(plot.margin=unit(c(0.2,2,0.2,0.2),"cm")) + theme(legend.position = "none")

primaryresearchlikertplot <- ggplot_gtable(ggplot_build(primaryresearchlikertplot))
primaryresearchlikertplot$layout$clip <- "off"

counts = lastdata_grouping %>%
  count(YearssincePhD) %>%
  mutate(variable=NA)

colnames(lastdata)[1] <- "Years since PhD"
likert_92 <- likert(lastdata, grouping = lastdata_grouping$YearssincePhD)
yearslikertplot = plot(likert_92) + 
  geom_text(data=counts,
            aes(label=format(n,big.mark=","), x=YearssincePhD, y=145), 
            size=3, colour="black", hjust=1) +
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(plot.margin=unit(c(0.2,2,0.2,0.2),"cm")) + theme(legend.position = "none")

yearslikertplot <- ggplot_gtable(ggplot_build(yearslikertplot))
yearslikertplot$layout$clip <- "off"

counts = lastdata_grouping %>%
  count(WhereLive) %>%
  mutate(variable=NA)

colnames(lastdata)[1] <- "Geographic location"
likert_22 <- likert(lastdata, grouping = lastdata_grouping$WhereLive)
wherelivelikertplot = plot(likert_22) + 
  geom_text(data=counts,
            aes(label=format(n,big.mark=","), x=WhereLive, y=145), 
            size=3, colour="black", hjust=1) +
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(plot.margin=unit(c(0.2,2,0.2,0.2),"cm")) + theme(legend.position = "none")

wherelivelikertplot <- ggplot_gtable(ggplot_build(wherelivelikertplot))
wherelivelikertplot$layout$clip <- "off"

counts = lastdata_grouping %>%
  count(Interdisciplinary) %>%
  mutate(variable=NA)

colnames(lastdata)[1] <- "Frequency of interdisciplinary research"
likert_72 <- likert(lastdata, grouping = lastdata_grouping$Interdisciplinary)
interdisciplinarylikertplot = plot(likert_72) + 
  geom_text(data=counts,
            aes(label=format(n,big.mark=","), x=Interdisciplinary, y=145), 
            size=3, colour="black", hjust=1) +
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(plot.margin=unit(c(0.2,2,0.2,0.2),"cm")) 

interdisciplinarylikertplot <- ggplot_gtable(ggplot_build(interdisciplinarylikertplot))
interdisciplinarylikertplot$layout$clip <- "off"


lastplotgrid6panel <- plot_grid(yearslikertplot, wherelivelikertplot, primaryresearchlikertplot, depttypelikertplot, basicappliedlikertplot, interdisciplinarylikertplot, 
                            labels = c("A", "B", "C", "D", "E", "F"), ncol = 1, nrow = 6,
                            rel_heights = c(0.20, 0.2, 0.2, 0.15, 0.12, 0.23))

save_plot("lastplotgrid6panel.jpg", lastplotgrid6panel, base_width = 9, base_height = 15)
```


### Does whether people pay attention to a CV statement vary based on age, country, research area, department and/or their views on last authorship?

```{r, CV statement crosstabs}
## subsetting only the statement data, but first filter by the grouping variables of interest
## then renaming factors, renaming question
statementdata <-
  polldata %>%
  filter(CVStatement01 != "NA", LastSenior != "NA", 
         WhereLive != "NA", BasicApplied != "NA", 
         depttype != "NA", PrimaryResearch != "NA") %>% 
  select(CVStatement) 

# order the data
statementdata$CVStatement <- factor(statementdata$CVStatement, 
                              c("No",
                                "I have never seen this, but would probably not pay attention to it",
                                "I have never seen this, but would probably pay attention to it",
                                "Yes"))

statementdata$CVStatement <- statementdata %>%
  use_series(CVStatement) %>%
  plyr::mapvalues(., c("No","I have never seen this, but would probably not pay attention to it","I have never seen this, but would probably pay attention to it","Yes"), c("No","Not seen, no","Not seen, yes","Yes"))

# changing the column name to the question
colnames(statementdata)[1] <- "Do you pay attention to a CV statement?"

## subsetting the likert data AND the grouping variables
polldata$youngold <- ifelse(polldata$PhD01 < 3, "young",
                            ifelse(polldata$PhD01 == 3, "middle",
                            ifelse(polldata$PhD01>3,"old","neither"
                                   )))

statementdata_grouping <-
  polldata %>%
  filter(CVStatement01 != "NA", LastSenior != "NA", 
         WhereLive != "NA", BasicApplied != "NA", 
         depttype != "NA", PrimaryResearch != "NA") %>%
  select(molecular, youngold, 
         WhereLive, BasicApplied, 
         depttype, PrimaryResearch, LastSenior, LastSenior01) 

## ordering the grouping factors
## then renaming the primary research responses
statementdata_grouping$molecular <- factor(statementdata_grouping$molecular, 
                                      c("molecular",
                                        "organismal", 
                                        "other"))
statementdata_grouping$youngold <- factor(statementdata_grouping$youngold, 
                                     c("young",
                                       "middle", 
                                       "old"))
levels(statementdata_grouping$PrimaryResearch)
levels(statementdata_grouping$PrimaryResearch) <- c("Biology Other", "Comp Ecol", "Field Ecol", "Lab Mol Ecol", "Mol Evol", "Organismal Evol", "Other")
statementdata_grouping$LastSenior <- factor(statementdata_grouping$LastSenior, 
                                            c("No",
                                              "Not sure, but probably no",
                                              "It depends, but probably no",
                                              "It depends, but probably yes",
                                              "Not sure, but probably yes",
                                              "Yes"))

statementdata_grouping$LastSeniorYesNo <- ifelse(statementdata_grouping$LastSenior01 < 4, "No", "Yes")
```

```{r, q4-crosstabfig, warning=FALSE}
## Plots
## plots##
colnames(statementdata)[1] <- "Career stage"
likert_32 <- likert(lastdata, grouping = lastdata_grouping$depttype)
plot(likert_32)

likert_13 <- likert(statementdata, grouping = statementdata_grouping$youngold)
plot(likert_13)
likert_23 <- likert(statementdata, grouping = statementdata_grouping$WhereLive)
plot(likert_23)
likert_33 <- likert(statementdata, grouping = statementdata_grouping$depttype)
plot(likert_33)
likert_43 <- likert(statementdata, grouping = statementdata_grouping$BasicApplied)
plot(likert_43)
likert_53 <- likert(statementdata, grouping = statementdata_grouping$PrimaryResearch)
plot(likert_53)
likert_63 <- likert(statementdata, grouping = statementdata_grouping$molecular)
plot(likert_63)
likert_73 <- likert(statementdata, grouping = statementdata_grouping$LastSenior)
plot(likert_73)
likert_83 <- likert(statementdata, grouping = statementdata_grouping$LastSeniorYesNo)
plot(likert_83)


likert_13.mpg <- plot(likert_13) + theme(legend.position = "none")
likert_23.mpg <- plot(likert_23) + theme(legend.position = "none")
likert_33.mpg <- plot(likert_33) + theme(legend.position = "none")
likert_43.mpg <- plot(likert_43) + theme(legend.position = "none")
likert_53.mpg <- plot(likert_53) + theme(legend.position = "none")
likert_63.mpg <- plot(likert_63) + theme(legend.position = "none")
likert_73.mpg <- plot(likert_73) 
likert_83.mpg <- plot(likert_83) 
statementplotgrid <- plot_grid(likert_13.mpg, likert_23.mpg, likert_33.mpg, likert_43.mpg, likert_53.mpg, likert_63.mpg, likert_73.mpg, likert_83.mpg,
                          labels = c("A", "B", "C", "D", "E", "F", "G", "H"), ncol = 2, nrow = 4,
                          rel_widths = c(0.5, 0.5),
                          rel_heights = c(0.3, 0.3, 0.35))

save_plot("statementplotgrid.jpg", statementplotgrid, base_width = 17, base_height = 15)

#ideally, would fix the above plot so that the title for each panel was the factor used to break down responses. But since there doesn't seem to be much going on with this, I'm just going to move on.
```

### Do views on corresponding authorship vary based on age, country, research area, and/or department?
```{r, cross tabs related to current corresponding authorship practices}
## subsetting only the corresponding author data, but first filter by the grouping variables of interest
## then renaming factors, renaming question
corrcurrdata <-
  polldata %>%
  filter(CorrespondingBest01 != "NA", LastSenior != "NA", 
         WhereLive != "NA", BasicApplied != "NA", 
         depttype != "NA", PrimaryResearch != "NA", Inter01 != "NA") %>% 
  select(CorrespondingCurrent,CorrespondingCurrent01,YearssincePhD,PhD01) 

corrcurrdata$PhDShort <- corrcurrdata$PhD01
corrcurrdata$PhDShort <- plyr::mapvalues(corrcurrdata$PhDShort, c(1, 2, 3, 4, 5, 6, 7), c("student","1 to 5", "6 to 10", "11 to 15", "16 to 20", "over 20", "no PhD"))

corrcurrdata$CorrespondingCurrentShort <- corrcurrdata$CorrespondingCurrent01
corrcurrdata$CorrespondingCurrentShort <- plyr::mapvalues(corrcurrdata$CorrespondingCurrentShort, c(1, 2, 3, 4, 5), c("questions","stable contact info", "uploaded files", "senior author", "full responsibility"))

currentsummary <- corrcurrdata %>%
  filter(PhD01 < 7) %>%
  group_by(PhDShort,CorrespondingCurrentShort) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

currentsummary$CorrespondingCurrentShort <- as.factor(currentsummary$CorrespondingCurrentShort)

currentsummary$PhDShort <- factor(currentsummary$PhDShort, 
                                     c("student","1 to 5", "6 to 10", "11 to 15", "16 to 20", "over 20"))

currentlineplot <- currentsummary %>%
  filter(CorrespondingCurrentShort != "NA") %>%
  ggplot(aes(x=PhDShort,y=rel.freq,color= CorrespondingCurrentShort,group=CorrespondingCurrentShort)) +
  geom_line(stat='identity',aes(linetype=CorrespondingCurrentShort),size=1) +
  geom_point(aes(shape=CorrespondingCurrentShort), size=4) +
  ggtitle("Views of people at different career stages on \ncurrent corresponding authorship practices") +
  scale_color_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73","#0072B2")) +
  ylab("Percent") +
  xlab("Years since PhD") + 
  guides(colour = guide_legend("Corresponding authorship"), linetype = guide_legend("Corresponding authorship"),
  shape = guide_legend("Corresponding authorship"))

currentlineplot

save_plot("currentlineplot.jpg", currentlineplot, base_width = 8, base_height = 4)
#1 = The corresponding author is the person that has taken responsibility for fielding questions about the paper post-publication  
#2 = The corresponding author is the person with the most stable contact info and/or internet access  
#3 = The corresponding author is usually the person who uploaded the files (usually the first author)  
#4 = The corresponding author is usually the senior author  
#5 = The corresponding author uploaded the files, managed the revisions and wrote the response to reviewers, and took responsibility for the paper after publication  

# questions = The corresponding author is the person that has taken responsibility for fielding questions about the paper post-publication  
# stable contact info = The corresponding author is the person with the most stable contact info and/or internet access  
# uploaded files = The corresponding author is usually the person who uploaded the files (usually the first author)  
# senior author = The corresponding author is usually the senior author  
# full responsibility = The corresponding author uploaded the files, managed the revisions and wrote the response to reviewers, and took responsibility for the paper after publication  

#1 = 0 (current students and people without a PhD should choose this)  
#2 = 1-5  
#3 = 6-10  
#4 = 11-15  
#5 = 16-20  
#6 = >20  
#7 = I do not have a PhD and am not a current student  

corrcurrdataecoevo <-
  polldata %>%
  filter(CorrespondingBest01 != "NA", LastSenior != "NA", 
         WhereLive != "NA", BasicApplied != "NA", 
         depttype != "NA", PrimaryResearch != "NA", Inter01 != "NA") %>% 
  select(CorrespondingCurrent,CorrespondingCurrent01,ecoevo) 

corrcurrdataecoevo$CorrespondingCurrentShort <- corrcurrdataecoevo$CorrespondingCurrent01
corrcurrdataecoevo$CorrespondingCurrentShort <- plyr::mapvalues(corrcurrdataecoevo$CorrespondingCurrentShort, c(1, 2, 3, 4, 5), c("questions","stable contact info", "uploaded files", "senior author", "full responsibility"))

currentsummaryecoevo <- corrcurrdataecoevo %>%
  filter(ecoevo != "other") %>%
  group_by(ecoevo,CorrespondingCurrentShort) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

currentsummaryecoevo$CorrespondingCurrentShort <- as.factor(currentsummaryecoevo$CorrespondingCurrentShort)

ecoevo = c("evolution")
CorrespondingCurrentShort = c("stable contact info")
n = c(0)
rel.freq = c(0)

missingdfecoevo <- data.frame(ecoevo, CorrespondingCurrentShort, n, rel.freq)
currentsummaryecoevo <- bind_rows(currentsummaryecoevo,missingdfecoevo)

currentlineplotecoevo <- currentsummaryecoevo %>%
  filter(CorrespondingCurrentShort != "NA") %>%
  ggplot(aes(x=ecoevo,y=rel.freq,color= CorrespondingCurrentShort)) +
  geom_line(stat='identity',aes(linetype=CorrespondingCurrentShort),size=1) +
  geom_point(aes(shape=CorrespondingCurrentShort), size=4) +
  ggtitle("Views of people at different career stages on \ncurrent corresponding authorship practices") +
  scale_color_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73","#0072B2")) +
  ylab("Percent")

currentbarplotecoevo <- currentsummaryecoevo %>%
  filter(CorrespondingCurrentShort != "NA") %>%
  ggplot(aes(x=ecoevo,y=rel.freq,fill= CorrespondingCurrentShort)) +
  geom_bar(stat='identity',aes(fill=CorrespondingCurrentShort),position=position_dodge(),color="black") +
  ggtitle("Views of ecologists vs. evolutionary biologists on \ncurrent corresponding authorship practices") +
  scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73","#0072B2")) +
  ylab("Percent") +
  xlab("Main research area") + 
  guides(fill=guide_legend(title="Corresponding authorship"))

currentbarplotecoevo

save_plot("currentbarplotecoevo.jpg", currentbarplotecoevo, base_width = 8, base_height = 4)


corrcurrdatadepttype <-
  polldata %>%
  filter(CorrespondingBest01 != "NA", LastSenior != "NA", 
         WhereLive != "NA", BasicApplied != "NA", 
         depttype != "NA", PrimaryResearch != "NA", Inter01 != "NA") %>% 
  select(CorrespondingCurrent,CorrespondingCurrent01,depttype) 

corrcurrdatadepttype$CorrespondingCurrentShort <- corrcurrdatadepttype$CorrespondingCurrent01
corrcurrdatadepttype$CorrespondingCurrentShort <- plyr::mapvalues(corrcurrdatadepttype$CorrespondingCurrentShort, c(1, 2, 3, 4, 5), c("questions","stable contact info", "uploaded files", "senior author", "full responsibility"))

currentsummarydepttype <- corrcurrdatadepttype %>%
  filter(depttype != "other") %>%
  group_by(depttype,CorrespondingCurrentShort) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

currentsummarydepttype$CorrespondingCurrentShort <- as.factor(currentsummarydepttype$CorrespondingCurrentShort)

currentbarplotdepttype <- currentsummarydepttype %>%
  filter(CorrespondingCurrentShort != "NA") %>%
  ggplot(aes(x=depttype,y=rel.freq,fill= CorrespondingCurrentShort)) +
  geom_bar(stat='identity',aes(fill=CorrespondingCurrentShort),position=position_dodge(),color="black") +
  ggtitle("Views of people in different department types on \ncurrent corresponding authorship practices") +
  scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73","#0072B2")) +
  ylab("Percent") +
  xlab("Department type") + 
  guides(fill=guide_legend(title="Corresponding authorship"))

currentbarplotdepttype

save_plot("currentbarplotdepttype.jpg", currentbarplotdepttype, base_width = 8, base_height = 4)

corrcurrdataregion <-
  polldata %>%
  filter(CorrespondingBest01 != "NA", LastSenior != "NA", 
         WhereLive != "NA", BasicApplied != "NA", 
         depttype != "NA", PrimaryResearch != "NA", Inter01 != "NA") %>% 
  filter(WhereLive01 < 6) %>%
  filter(WhereLive01 > 3) %>%
  select(CorrespondingCurrent,CorrespondingCurrent01,WhereLive) 

corrcurrdataregion$CorrespondingCurrentShort <- corrcurrdataregion$CorrespondingCurrent01
corrcurrdataregion$CorrespondingCurrentShort <- plyr::mapvalues(corrcurrdataregion$CorrespondingCurrentShort, c(1, 2, 3, 4, 5), c("questions","stable contact info", "uploaded files", "senior author", "full responsibility"))

currentsummaryregion <- corrcurrdataregion %>%
  group_by(WhereLive,CorrespondingCurrentShort) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

currentbarplotregion <- currentsummaryregion %>%
  filter(CorrespondingCurrentShort != "NA") %>%
  ggplot(aes(x=WhereLive,y=rel.freq,fill= CorrespondingCurrentShort)) +
  geom_bar(stat='identity',aes(fill=CorrespondingCurrentShort),position=position_dodge(),color="black") +
  ggtitle("Views of people in Europe and North America on \ncurrent corresponding authorship practices") +
  scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73","#0072B2")) +
  ylab("Percent") +
  xlab("Location") + 
  guides(fill=guide_legend(title="Corresponding authorship"))

currentbarplotregion

save_plot("currentbarplotregion.jpg", currentbarplotregion, base_width = 8, base_height = 4)
```

```{r, combining plots related to corresponding authorship views into one}
correspondingplotgrid4panel <- plot_grid(currentlineplot, currentbarplotecoevo, currentbarplotdepttype, currentbarplotregion, 
                            labels = c("A", "B", "C", "D"), ncol = 1, nrow = 4,
                            rel_heights = c(0.25, 0.25, 0.25, 0.25))

save_plot("correspondingplotgrid4panel.jpg", correspondingplotgrid4panel, base_width = 8, base_height = 13)
```

## Analysis of data on papers in Ecology 1956-2016

```{r, import data on authorship over time}
timedata <- read.csv("Authorshipacrosstime.csv", na.strings="?")
str(timedata)

Journal = c("Evolution","Evolution","Evolution","Evolution","Evolution","AmNat","AmNat","AmNat","AmNat","AmNat")
Year = c(1956,1966,1976,1986,1996,1956,1966,1976,1986,1996)
Number.authors = c(1,1,1,1,1,1,1,1,1,1)
#adding these as ones so I can make the box widths equal; will color the boxes white below so they don't appear.

missingdf3 <- data.frame(Journal, Year, Number.authors)
timedatamerge <- bind_rows(timedata,missingdf3)
```

```{r, plot number of authors over time}
timeplot <- timedata %>%
  filter(Journal == c("Ecology")) %>%
  ggplot(aes(x=Year,y=Number.authors,fill=Journal,group=interaction(Journal,Year))) +
  scale_fill_manual(values=c("white","#999999")) +
  geom_boxplot(width=4) +
  theme_bw() + 
  ggtitle("Number of authors of articles in first or \nsecond issue of Ecology, 1956-2016") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks=c(1956,1966,1976,1986,1996,2006,2016)) +
  ylab("Number of authors") 

timeplot

save_plot("timeplot.jpg", timeplot, base_width = 6, base_height = 4)
```

```{r, plot number of authors over time including Evolution}
timeplotwithevol <- timedatamerge %>%
  filter(Journal != c("AmNat")) %>%
  ggplot(aes(x=Year,y=Number.authors,fill=Journal,group=interaction(Journal,Year))) +
  scale_fill_manual(values=c("white","#999999")) +
  geom_boxplot(width=4) +
  theme_bw() + 
  ggtitle("Number of authors of articles in first or \nsecond issue of journal, 1956-2016") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks=c(1956,1966,1976,1986,1996,2006,2016)) +
  ylab("Number of authors") +
  ylim(0,20)

timeplotwithevol
#Still need to fix box width issue in this figure
```

```{r, plot number of authors 2001-2016 for all journals}
timeplotalljournals <- timedatamerge %>%
  filter(Year>2000) %>%
  ggplot(aes(x=Year,y=Number.authors,fill=Journal,group=interaction(Journal,Year))) +
  scale_fill_manual(values=c("white","#999999","#CCCCCC")) +
  geom_boxplot(width=4) +
  theme_bw() + 
  ggtitle("Number of authors of articles in first and/or \nsecond issue of journal, 2001-2016") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks=c(2001,2006,2011,2016)) +
  ylab("Number of authors") 

timeplotalljournals


save_plot("timeplotalljournals.jpg", timeplotalljournals, base_width = 6, base_height = 4)

#combine plot with just ecology for all years with plot for all journals for 2001-2016
timeplotgrid2panel <- plot_grid(timeplot, timeplotalljournals, 
                            labels = c("A", "B"), ncol = 1, nrow = 2,
                            rel_heights = c(0.5, 0.5))

save_plot("timeplotgrid2panel.jpg", timeplotgrid2panel, base_width = 8, base_height = 8)
```

```{r, plot showing all three journals for whole time period with normal-looking boxes}
timeplotalljournalsallyears <- timedatamerge %>%
  ggplot(aes(x=Year,y=Number.authors,fill=Journal,group=interaction(Journal,Year),color=interaction(Journal,Year))) +
  scale_fill_manual(values=c("white","#999999","#CCCCCC")) +
  scale_color_manual(values=c("white","black","white","white","black","white","white","black","white","white","black","white","white","black","white","black","black","black","black","black","black","black","black","black","black","black","black"),guide=FALSE) +
  geom_boxplot(width=4) +
  theme_bw() + 
  ggtitle("Number of authors of articles in first and/or \nsecond issue of journal, 1956-2016") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks=c(1956,1966,1976,1986,1996,2006,2016)) +
  ylab("Number of authors") 

timeplotalljournalsallyears


save_plot("timeplotalljournalsallyears.jpg", timeplotalljournalsallyears, base_width = 6, base_height = 4)

```

```{r, plot of corresponding authors over time}

timesummary <- timedata %>%
  filter(Journal == c("Ecology")) %>%
  group_by(Year,Correspondence) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

Year = c(2006,2011,2016,2001,2006,2011,2016,2001,2006,2011,2016)
Correspondence = c("ND","ND","ND","all","all","all","all","other","other","other","other")
n = c(0,0,0,0,0,0,0,0,0,0,0)
rel.freq = c(0,0,0,0,0,0,0,0,0,0,0)

missingdf <- data.frame(Year, Correspondence, n, rel.freq)
timesummary <- bind_rows(timesummary,missingdf)

timecorrplotecol <- timesummary %>%
  filter(Year>2000) %>%
  mutate(Correspondence = as.character(Correspondence)) %>%
  mutate(Correspondence = factor(Correspondence, levels=c("first","middle","last","ND","all","other"))) %>%
  ggplot(aes(x=Year,y=rel.freq,fill= Correspondence)) +
  geom_bar(stat='identity',position=position_dodge(),color='black') +
  ggtitle("Corresponding author position for articles in \nfirst or second issue of Ecology") +
  scale_x_continuous(breaks=c(2001,2006,2011,2016)) +
  scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442","#0072B2")) +
  ylab("Percent")

timecorrlineplotecol <- timesummary %>%
  filter(Year>2000) %>%
  mutate(Correspondence = as.character(Correspondence)) %>%
  mutate(Correspondence = factor(Correspondence, levels=c("first","middle","last","ND","all","other"))) %>%
  ggplot(aes(x=Year,y=rel.freq,color= Correspondence)) +
  geom_line(stat='identity',aes(linetype=Correspondence),size=1) +
  geom_point(aes(shape=Correspondence), size=4) +
  ggtitle("Corresponding author position for articles in \nfirst or second issue of Ecology") +
  scale_x_continuous(breaks=c(2001,2006,2011,2016)) +
  scale_color_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73", "#000000","#0072B2")) +
  ylab("Percent")

timecorrlineplotecol

timesummaryevol <- timedata %>%
  filter(Journal == c("Evolution")) %>%
  group_by(Year,Correspondence) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

timesummaryevol$Year <- as.numeric(timesummaryevol$Year)

Year = c(2001,2006,2011,2016,2006,2011,2016,2011,2016,2016)
Correspondence = c("ND","ND","ND","ND","middle","middle","middle","other","other","all")
n = c(0,0,0,0,0,0,0,0,0,0)
rel.freq = c(0,0,0,0,0,0,0,0,0,0)

missingdf2 <- data.frame(Year, Correspondence, n, rel.freq)
timesummaryevol <- bind_rows(timesummaryevol,missingdf2)

timecorrplotevol <- timesummaryevol %>%
  filter(Year>2000) %>%
  mutate(Correspondence = as.character(Correspondence)) %>%
  mutate(Correspondence = factor(Correspondence, levels=c("first","middle","last","ND","all","other"))) %>%
  ggplot(aes(x=Year,y=rel.freq,fill= Correspondence)) +
  geom_bar(stat='identity',position=position_dodge(),color='black') +
  ggtitle("Corresponding author position for articles in \nfirst issue of Evolution") +
  scale_x_continuous(breaks=c(2001,2006,2011,2016)) +
  scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442","#0072B2")) +
  ylab("Percent")

timecorrlineplotevol <- timesummaryevol %>%
  filter(Year>2000) %>%
  mutate(Correspondence = as.character(Correspondence)) %>%
  mutate(Correspondence = factor(Correspondence, levels=c("first","middle","last","ND","all","other"))) %>%
  ggplot(aes(x=Year,y=rel.freq,color= Correspondence)) +
  geom_line(stat='identity',aes(linetype=Correspondence),size=1) +
  geom_point(aes(shape=Correspondence), size=4) +
  ggtitle("Corresponding author position for articles in \nfirst issue of Evolution") +
  scale_x_continuous(breaks=c(2001,2006,2011,2016)) +
  scale_color_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73", "#000000","#0072B2")) +
  ylab("Percent")

twopanellineplot <- ggdraw() +
  draw_plot(timecorrlineplotecol,0,0.5,1.0,0.5) +
  draw_plot(timecorrlineplotevol,0,0,1.0,0.5) 

twopanellineplot

save_plot("timecorrlineplotecol.jpg", timecorrlineplotecol, base_width = 8, base_height = 4)
save_plot("timecorrlineplotevol.jpg", timecorrlineplotevol, base_width = 8, base_height = 4)
```

```{r, time plot for AmNat}
timesummaryamnat <- timedata %>%
  filter(Journal == c("AmNat")) %>%
  group_by(Year,Correspondence) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

timesummaryamnat$Year <- as.numeric(timesummaryamnat$Year)

Year = c(2001,2001,2006,2006,2011,2011,2011,2011,2016,2016,2016,2016)
Correspondence = c("ND","middle","ND","last","ND","middle","all","other","ND","middle","all","other")
n = c(0,0,0,0,0,0,0,0,0,0,0,0)
rel.freq = c(0,0,0,0,0,0,0,0,0,0,0,0)

missingdf4 <- data.frame(Year, Correspondence, n, rel.freq)
timesummaryamnat <- bind_rows(timesummaryamnat,missingdf4)

timecorrlineplotamnat <- timesummaryamnat %>%
  filter(Year>2000) %>%
  mutate(Correspondence = as.character(Correspondence)) %>%
  mutate(Correspondence = factor(Correspondence, levels=c("first","middle","last","ND","all","other"))) %>%
  ggplot(aes(x=Year,y=rel.freq,color= Correspondence)) +
  geom_line(stat='identity',aes(linetype=Correspondence),size=1) +
  geom_point(aes(shape=Correspondence), size=4) +
  ggtitle("Corresponding author position for articles in \nfirst and second issues of American Naturalist") +
  scale_x_continuous(breaks=c(2001,2006,2011,2016)) +
  scale_color_manual(values=c("#999999", "#E69F00", "#56B4E9", "#009E73", "#000000","#0072B2")) +
  ylab("Percent") +
  ylim(0,100)

threepanellineplot <- ggdraw() +
  draw_plot(timecorrlineplotecol,0,0.67,1.0,0.33) +
  draw_plot(timecorrlineplotamnat,0,0.33,1.0,0.33) +
  draw_plot(timecorrlineplotevol,0,0,1.0,0.33) 

save_plot("threepanellineplot.jpg", threepanellineplot, base_width = 8, base_height = 12)
```

```{r, 2016 corresponding authorship summary}
corr2016summary <- timedata %>%
  filter(Year > 2015) %>%
  group_by(Correspondence) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))
```
